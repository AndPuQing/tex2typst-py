(()=>{function f(e,r="Assertion failed."){if(!e)throw new Error(r)}var o=class C{type;value;constructor(r,t){this.type=r,this.value=t}eq(r){return this.type===r.type&&this.value===r.value}toString(){switch(this.type){case 4:return"%"+this.value;default:return this.value}}toNode(){return new le(this)}static EMPTY=new C(0,"");static COMMAND_DISPLAYSTYLE=new C(2,"\\displaystyle");static COMMAND_TEXTSTYLE=new C(2,"\\textstyle")},y=class{type;head;constructor(e,r){this.type=e,this.head=r||o.EMPTY}eq(e){return this.type===e.type&&this.head.eq(e.head)}toString(){return this.serialize().reduce(pe,"")}},le=class extends y{constructor(e){super("terminal",e)}serialize(){switch(this.head.type){case 0:return[];case 1:case 2:case 3:case 4:case 7:return[this.head];case 5:case 6:{let e=[];for(let r of this.head.value){let t=r===" "?5:6;e.push(new o(t,r))}return e}default:throw new Error(`Unknown terminal token type: ${this.head.type}`)}}},oe=class extends y{constructor(e){f(e.type===3),super("text",e)}serialize(){return[new o(2,"\\text"),new o(1,"{"),this.head,new o(1,"}")]}},T=class extends y{items;constructor(e){super("ordgroup",o.EMPTY),this.items=e}serialize(){return this.items.map(e=>e.serialize()).flat()}},ue=class extends y{base;sup;sub;constructor(e){super("supsub",o.EMPTY),this.base=e.base,this.sup=e.sup,this.sub=e.sub}serialize(){let e=[],{base:r,sup:t,sub:n}=this;e=e.concat(r.serialize());function a(i){return i.type==="ordgroup"||i.type==="supsub"||i.head.type===0?!0:!!(i.head.type===1&&/\d+(\.\d+)?/.test(i.head.value)&&i.head.value.length>1)}return n&&(e.push(new o(7,"_")),a(n)?(e.push(new o(1,"{")),e=e.concat(n.serialize()),e.push(new o(1,"}"))):e=e.concat(n.serialize())),t&&(e.push(new o(7,"^")),a(t)?(e.push(new o(1,"{")),e=e.concat(t.serialize()),e.push(new o(1,"}"))):e=e.concat(t.serialize())),e}},x=class extends y{args;data;constructor(e,r,t=null){super("funcCall",e),this.args=r,this.data=t}serialize(){let e=[];e.push(this.head),this.head.value==="\\sqrt"&&this.data&&(e.push(new o(1,"[")),e=e.concat(this.data.serialize()),e.push(new o(1,"]")));for(let r of this.args)e.push(new o(1,"{")),e=e.concat(r.serialize()),e.push(new o(1,"}"));return e}},ce=class extends y{body;left;right;constructor(e){super("leftright",o.EMPTY),this.body=e.body,this.left=e.left,this.right=e.right}serialize(){let e=[];return e.push(new o(2,"\\left")),e.push(new o(1,this.left?this.left.value:".")),e=e.concat(this.body.serialize()),e.push(new o(2,"\\right")),e.push(new o(1,this.right?this.right.value:".")),e}},he=class extends y{matrix;data;constructor(e,r,t=null){f(e.type===3),super("beginend",e),this.matrix=r,this.data=t}serialize(){let e=[],r=this.matrix;e.push(new o(2,"\\begin")),e.push(new o(1,"{")),e=e.concat(this.head),e.push(new o(1,"}")),e.push(new o(6,`
`));for(let t=0;t<r.length;t++){let n=r[t];for(let a=0;a<n.length;a++){let i=n[a];e=e.concat(i.serialize()),a!==n.length-1&&e.push(new o(7,"&"))}t!==r.length-1&&e.push(new o(7,"\\\\"))}return e.push(new o(6,`
`)),e.push(new o(2,"\\end")),e.push(new o(1,"{")),e=e.concat(this.head),e.push(new o(1,"}")),e}};function pe(e,r){let t=r.toString(),n=!1;return r.type===5?n=!0:(n||=/[{\(\[\|]$/.test(e),n||=/\\\w+$/.test(e)&&t==="[",n||=/^[\.,;:!\?\(\)\]{}_^]$/.test(t),n||=["\\{","\\}"].includes(t),n||=t==="'",n||=e.endsWith("_")||e.endsWith("^"),n||=/\s$/.test(e),n||=/^\s/.test(t),n||=e==="",n||=/[\(\[{]\s*(-|\+)$/.test(e)||e==="-"||e==="+",n||=e.endsWith("&")&&t==="=",n||=/\d$/.test(e)&&/^[a-zA-Z]$/.test(t)),n||(e+=" "),e+t}function de(e,r,t=0){let n=e.slice(t).findIndex(a=>a.eq(r));return n===-1?-1:n+t}function we(e,r){return e.some(t=>t.eq(r))}function W(e,r){let t=[],n=[];for(let a of e)a.eq(r)?(t.push(n),n=[]):n.push(a);return t.push(n),t}function ge(e,r){return e.flatMap((t,n)=>n!==e.length-1?[...t,r]:t)}var re={};function fe(e,r){let t=e.reMatchArray[0].length,n=r.reMatchArray[0].length;return n!==t?n-t:e.index-r.index}var me=class{_input;_lexer;_pos=0;_line=0;_col=0;_offset=0;_less=null;_go=!1;_newstate=null;_state;_text=null;_leng=null;_reMatchArray=null;constructor(e,r){this._input=e,this._lexer=r,this._state=r.states[0]}text(){return this._text}leng(){return this._leng}reMatchArray(){return this._reMatchArray}pos(){return this._pos}line(){return this._line}column(){return this._col}input(){return this._input.charAt(this._pos+this._leng+this._offset++)}unput(){return this._offset=this._offset>0?this._offset--:0}less(e){return this._less=e,this._offset=0,this._text=this._text.substring(0,e),this._leng=this._text.length}pushback(e){return this.less(this._leng-e)}reject(){this._go=!0}begin(e){if(this._lexer.specification[e])return this._newstate=e;let r=this._lexer.states[parseInt(e)];if(r)return this._newstate=r;throw"Unknown state '"+e+"' requested"}state(){return this._state}scan(){if(this._pos>=this._input.length)return re;let e=this._input.substring(this._pos),r=this._lexer.specification[this._state],t=[];for(let c=0;c<r.length;c++){let h=r[c],g=e.match(h.re);g!==null&&g[0].length>0&&t.push({index:c,rule:h,reMatchArray:g})}if(t.length===0)throw new Error("No match found for input '"+e+"'");t.sort(fe),this._go=!0;let n,a;for(let c=0,h=t.length;c<h&&this._go;c++){this._offset=0,this._less=null,this._go=!1,this._newstate=null;let g=t[c];if(a=g.reMatchArray[0],this._text=a,this._leng=a.length,this._reMatchArray=g.reMatchArray,n=g.rule.action(this),this._newstate&&this._newstate!=this._state){this._state=this._newstate;break}}let i=this._less===null?a:a.substring(0,this._less),l=i.length;this._pos+=l+this._offset;let u=i.match(/\n/g);return u!==null?(this._line+=u.length,this._col=l-i.lastIndexOf(`
`)-1):this._col+=l,n}},be=class{states;specification;constructor(e){this.states=Object.keys(e),this.specification={};for(let r of this.states){let t=e[r];if(r in this.specification)throw"Duplicate state declaration encountered for state '"+r+"'";this.specification[r]=[];for(let[n,a]of t.entries()){let i;try{i=new RegExp("^"+n)}catch(l){throw"Invalid regexp '"+n+"' in state '"+r+"' ("+l.message+")"}this.specification[r].push({re:i,action:a})}}}scanner(e){return new me(e,this)}lex(e,r){let t=this.scanner(e);for(;;){let n=t.scan();if(n===re)return;n!==void 0&&r(n)}}collect(e){let r=[],t=function(n){Array.isArray(n)?r.push(...n):r.push(n)};return this.lex(e,t),r}},ne=["sqrt","text","bar","bold","boldsymbol","ddot","dot","hat","mathbb","mathbf","mathcal","mathfrak","mathit","mathrm","mathscr","mathsf","mathtt","operatorname","overbrace","overline","pmb","rm","tilde","underbrace","underline","vec","widehat","widetilde","overleftarrow","overrightarrow","hspace","substack","set","displaylines","mathinner","mathrel","mathbin","mathop","not"],ae=["frac","tfrac","binom","dbinom","dfrac","tbinom","overset","underset","textcolor"];function ve(e){let r=["{","}","\\","$","&","#","_","%"];for(let t of r)e=e.replaceAll("\\"+t,t);return e}var qe=new Map([[String.raw`\\begin{(array|subarry)}{(.+?)}`,e=>{let r=e.reMatchArray();return[new o(2,"\\begin"),new o(7,"{"),new o(3,r[1]),new o(7,"}"),new o(7,"{"),new o(3,r[2]),new o(7,"}")]}],[String.raw`\\(text|operatorname|textcolor|begin|end|hspace|array){(.+?)}`,e=>{let r=e.reMatchArray();return[new o(2,"\\"+r[1]),new o(7,"{"),new o(3,ve(r[2])),new o(7,"}")]}],[String.raw`%[^\n]*`,e=>new o(4,e.text().substring(1))],[String.raw`[{}_^&]`,e=>new o(7,e.text())],[String.raw`\\[\\,:;! ]`,e=>new o(7,e.text())],[String.raw`\r?\n`,e=>new o(6,`
`)],[String.raw`\s+`,e=>new o(5,e.text())],[String.raw`\\[{}%$&#_|]`,e=>new o(1,e.text())],[String.raw`(\\[a-zA-Z]+)(\s*\d|\s+[a-zA-Z])\s*([0-9a-zA-Z])`,e=>{let r=e.reMatchArray(),t=r[1];if(ae.includes(t.substring(1))){let n=r[2].trimStart(),a=r[3];return[new o(2,t),new o(1,n),new o(1,a)]}else return e.reject(),[]}],[String.raw`(\\[a-zA-Z]+)(\s*\d|\s+[a-zA-Z])`,e=>{let r=e.reMatchArray(),t=r[1];if(ne.includes(t.substring(1))){let n=r[2].trimStart();return[new o(2,t),new o(1,n)]}else return e.reject(),[]}],[String.raw`\\[a-zA-Z]+`,e=>new o(2,e.text())],[String.raw`[0-9]+(\.[0-9]+)?`,e=>new o(1,e.text())],[String.raw`[a-zA-Z]`,e=>new o(1,e.text())],[String.raw`[+\-*/='<>!.,;:?()\[\]|]`,e=>new o(1,e.text())],[String.raw`[^\x00-\x7F]`,e=>new o(1,e.text())],[String.raw`.`,e=>new o(8,e.text())]]),_e={start:qe};function se(e){return new be(_e).collect(e)}var ye=["bigl","bigr","bigm","biggl","biggr","biggm","Bigl","Bigr","Bigm","Biggl","Biggr","Biggm"],j=o.EMPTY.toNode();function xe(e){return ne.includes(e)?1:ae.includes(e)?2:0}var k=new o(7,"{"),S=new o(7,"}"),Ee=new o(1,"["),Te=new o(1,"]");function M(e,r){let t=r;for(;t<e.length&&[5,6].includes(e[t].type);)t++;return e.slice(r,t)}function X(e,r){let t=e[r];return t.type===1&&["(",")","[","]","|","\\{","\\}",".","\\|"].includes(t.value)||t.type===2&&["lfloor","rfloor","lceil","rceil","langle","rangle","lparen","rparen","lbrace","rbrace"].includes(t.value.slice(1))?t:null}function N(e,r){let t=r;for(;t<e.length&&e[t].eq(new o(1,"'"));)t+=1;return t-r}var V=new o(2,"\\left"),K=new o(2,"\\right"),Z=new o(2,"\\begin"),Q=new o(2,"\\end"),Se=new o(7,"\\\\"),p=class v extends Error{constructor(r){super(r),this.name="LatexParserError"}static UNMATCHED_LEFT_BRACE=new v("Unmatched '\\{'");static UNMATCHED_RIGHT_BRACE=new v("Unmatched '\\}'");static UNMATCHED_LEFT_BRACKET=new v("Unmatched '\\['");static UNMATCHED_RIGHT_BRACKET=new v("Unmatched '\\]'");static UNMATCHED_COMMAND_BEGIN=new v("Unmatched '\\begin'");static UNMATCHED_COMMAND_END=new v("Unmatched '\\end'");static UNMATCHED_COMMAND_LEFT=new v("Unmatched '\\left'");static UNMATCHED_COMMAND_RIGHT=new v("Unmatched '\\right'")},P=new o(7,"_"),U=new o(7,"^"),Ne=class{space_sensitive;newline_sensitive;alignmentDepth=0;constructor(e=!1,r=!0){this.space_sensitive=e,this.newline_sensitive=r}parse(e){let r=new o(2,"\\displaystyle"),t=de(e,r);if(t===-1)return this.parseGroup(e.slice(0));if(t===0){let n=this.parseGroup(e.slice(1));return new x(r,[n])}else{let n=this.parseGroup(e.slice(0,t)),a=this.parseGroup(e.slice(t+1,e.length)),i=new x(r,[a]);return new T([n,i])}}parseGroup(e){let[r,t]=this.parseClosure(e,0,null);return r}parseClosure(e,r,t){let n=[],a=r;for(;a<e.length&&!(t!==null&&e[a].eq(t));){let[l,u]=this.parseNextExpr(e,a);a=u,!((l.head.type===5||l.head.type===6)&&(!this.space_sensitive&&l.head.value.replace(/ /g,"").length===0||!this.newline_sensitive&&l.head.value===`
`))&&n.push(l)}if(a>=e.length&&t!==null)return[j,-1];let i;return n.length===1?i=n[0]:i=new T(n),[i,a+1]}parseNextExpr(e,r){let[t,n]=this.parseNextExprWithoutSupSub(e,r),a=null,i=null,l=0;if(l+=N(e,n),n+=l,n<e.length){let u=e[n];if(u.eq(P)){if([a,n]=this.parseNextExprWithoutSupSub(e,n+1),l+=N(e,n),n+=l,n<e.length&&e[n].eq(U)&&([i,n]=this.parseNextExprWithoutSupSub(e,n+1),N(e,n)>0))throw new p("Double superscript")}else if(u.eq(U)){if([i,n]=this.parseNextExprWithoutSupSub(e,n+1),N(e,n)>0)throw new p("Double superscript");if(n<e.length&&e[n].eq(P)&&([a,n]=this.parseNextExprWithoutSupSub(e,n+1),N(e,n)>0))throw new p("Double superscript")}}if(a!==null||i!==null||l>0){let u={base:t,sup:null,sub:null};if(a&&(u.sub=a),l>0){let c=[];for(let h=0;h<l;h++)c.push(new o(1,"'").toNode());i&&c.push(i),u.sup=c.length===1?c[0]:new T(c)}else i&&(u.sup=i);return[new ue(u),n]}else return[t,n]}parseNextExprWithoutSupSub(e,r){if(r>=e.length)throw new p("Unexpected end of input");let t=e[r];switch(t.type){case 1:case 3:case 4:case 5:case 6:return[t.toNode(),r+1];case 2:let n=t.value.slice(1);if(ye.includes(n))return this.parseNextExprWithoutSupSub(e,r+1);if(t.eq(Z))return this.parseBeginEndExpr(e,r);if(t.eq(Q))throw p.UNMATCHED_COMMAND_END;if(t.eq(V))return this.parseLeftRightExpr(e,r);if(t.eq(K))throw p.UNMATCHED_COMMAND_RIGHT;return this.parseCommandExpr(e,r);case 7:switch(t.value){case"{":let[i,l]=this.parseClosure(e,r+1,S);if(l===-1)throw p.UNMATCHED_LEFT_BRACE;return[i,l];case"}":throw p.UNMATCHED_RIGHT_BRACE;case"\\\\":case"\\!":case"\\,":case"\\:":case"\\;":return[t.toNode(),r+1];case"\\ ":return[t.toNode(),r+1];case"_":case"^":return[j,r];case"&":if(this.alignmentDepth<=0)throw new p("Unexpected & outside of an alignment");return[t.toNode(),r+1];default:throw new p("Unknown control sequence")}default:throw new p("Unknown token type")}}parseCommandExpr(e,r){f(e[r].type===2);let t=e[r],n=t.value,a=r+1;switch(xe(n.slice(1))){case 0:return[t.toNode(),a];case 1:{if(a>=e.length)throw new p("Expecting argument for "+n);if(n==="\\sqrt"&&a<e.length&&e[a].eq(Ee)){let[c,h]=this.parseClosure(e,a+1,Te);if(h===-1)throw p.UNMATCHED_LEFT_BRACKET;let[g,R]=this.parseNextArg(e,h);return[new x(t,[g],c),R]}else if(n==="\\text"){if(a+2>=e.length)throw new p("Expecting content for \\text command");f(e[a].eq(k)),f(e[a+1].type===3),f(e[a+2].eq(S));let c=e[a+1];return[new oe(c),a+3]}else if(n==="\\displaylines"){f(e[a].eq(k));let[c,h]=this.parseAligned(e,a+1,S);if(h===-1)throw p.UNMATCHED_LEFT_BRACE;let g=new T(ge(c,Se.toNode()));return[new x(t,[g]),h]}let[l,u]=this.parseNextArg(e,a);return[new x(t,[l]),u]}case 2:{let[l,u]=this.parseNextArg(e,a),[c,h]=this.parseNextArg(e,u);return[new x(t,[l,c]),h]}default:throw new Error("Invalid number of parameters")}}parseNextArg(e,r){let t=r,n=null;for(;t<e.length;){let a;if([a,t]=this.parseNextExprWithoutSupSub(e,t),!(a.head.type===5||a.head.type===6)){n=a;break}}if(n===null)throw new p("Expecting argument but token stream ended");return[n,t]}parseLeftRightExpr(e,r){f(e[r].eq(V));let t=r+1;if(t+=M(e,t).length,t>=e.length)throw new p("Expecting a delimiter after \\left");let n=X(e,t);if(n===null)throw new p("Invalid delimiter after \\left");t++;let[a,i]=this.parseClosure(e,t,K);if(i===-1)throw p.UNMATCHED_COMMAND_LEFT;if(t=i,t+=M(e,t).length,t>=e.length)throw new p("Expecting a delimiter after \\right");let l=X(e,t);if(l===null)throw new p("Invalid delimiter after \\right");t++;let u=n.value==="."?null:n,c=l.value==="."?null:l;return[new ce({body:a,left:u,right:c}),t]}parseBeginEndExpr(e,r){f(e[r].eq(Z));let t=r+1;f(e[t].eq(k)),f(e[t+1].type===3),f(e[t+2].eq(S));let n=e[t+1].value;t+=3;let a=null;["array","subarray"].includes(n)&&(t+=M(e,t).length,[a,t]=this.parseNextArg(e,t));let[i,l]=this.parseAligned(e,t,Q);if(l===-1)throw p.UNMATCHED_COMMAND_BEGIN;if(t=l,f(e[t].eq(k)),f(e[t+1].type===3),f(e[t+2].eq(S)),e[t+1].value!==n)throw new p("\\begin and \\end environments mismatch");return t+=3,[new he(new o(3,n),i,a),t]}parseAligned(e,r,t){this.alignmentDepth++;let n=r;n+=M(e,n).length;let a;if([a,n]=this.parseClosure(e,n,t),n===-1)return[[],-1];let i;if(a.type==="ordgroup"){let l=a.items;for(;l.length>0&&[5,6].includes(l[l.length-1].head.type);)l.pop();i=W(l,new o(7,"\\\\").toNode()).map(u=>W(u,new o(7,"&").toNode()).map(c=>new T(c)))}else i=[[a]];return this.alignmentDepth--,[i,n]}};function Ae(e){let r=n=>n.eq(P)||n.eq(U),t=[];for(let n=0;n<e.length;n++)e[n].type===5&&n+1<e.length&&r(e[n+1])||e[n].type===5&&n-1>=0&&r(e[n-1])||t.push(e[n]);return t}function ke(e,r){let t=[];for(let n of e)if(n.type===2&&r[n.value]){let a=se(r[n.value]);t=t.concat(a)}else t.push(n);return t}function Me(e,r={}){let t=new Ne,n=se(e);return n=Ae(n),n=ke(n,r),t.parse(n)}var H=new Map([["arrow.l.r.double.long","<==>"],["arrow.l.r.long","<-->"],["arrow.r.bar","|->"],["arrow.r.double.bar","|=>"],["arrow.r.double.long","==>"],["arrow.r.long","-->"],["arrow.r.long.squiggly","~~>"],["arrow.r.tail",">->"],["arrow.r.twohead","->>"],["arrow.l.double.long","<=="],["arrow.l.long","<--"],["arrow.l.long.squiggly","<~~"],["arrow.l.tail","<-<"],["arrow.l.twohead","<<-"],["arrow.l.r","<->"],["arrow.l.r.double","<=>"],["colon.double.eq","::="],["dots.h","..."],["gt.triple",">>>"],["lt.triple","<<<"],["arrow.r","->"],["arrow.r.double","=>"],["arrow.r.squiggly","~>"],["arrow.l","<-"],["arrow.l.squiggly","<~"],["bar.v.double","||"],["bracket.l.double","[|"],["bracket.r.double","|]"],["colon.eq",":="],["eq.colon","=:"],["eq.not","!="],["gt.double",">>"],["gt.eq",">="],["lt.double","<<"],["lt.eq","<="],["ast.op","*"],["minus","-"],["tilde.op","~"]]),Y=new Map;for(let[e,r]of H.entries())r.length>1&&Y.set(r,e);var s=class w{type;value;constructor(r,t){this.type=r,this.value=t}eq(r){return this.type===r.type&&this.value===r.value}isOneOf(r){return we(r,this)}toNode(){return new Ce(this)}toString(){switch(this.type){case 4:return`"${this.value}"`;case 5:return`//${this.value}`;default:return this.value}}static NONE=new w(0,"#none");static EMPTY=new w(2,"");static LEFT_BRACE=new w(2,"{");static RIGHT_BRACE=new w(2,"}");static LEFT_DELIMITERS=[new w(2,"("),new w(2,"["),new w(2,"{"),new w(2,"|"),new w(1,"angle.l"),new w(1,"paren.l"),new w(1,"brace.l")];static RIGHT_DELIMITERS=[new w(2,")"),new w(2,"]"),new w(2,"}"),new w(2,"|"),new w(1,"angle.r"),new w(1,"paren.r"),new w(1,"brace.r")]},Oe=class extends Error{node;constructor(e,r){super(e),this.name="TypstWriterError",this.node=r}},A=new s(7," "),_=class{type;head;options;constructor(e,r){this.type=e,this.head=r||s.NONE}setOptions(e){this.options=e}eq(e){return this.type===e.type&&this.head.eq(e.head)}toString(){throw new Error("Unimplemented toString() in base class TypstNode")}},Ce=class extends _{constructor(e){super("terminal",e)}isOverHigh(){return!1}toString(){return this.head.toString()}serialize(e,r){if(this.head.type===2){if(this.head.value===","&&e.insideFunctionDepth>0)return[new s(1,"comma")]}else if(this.head.type===1){let t=this.head.value;return r.preferShorthands&&H.has(t)&&(t=H.get(t)),r.inftyToOo&&t==="infinity"&&(t="oo"),[new s(1,t)]}else if(this.head.type===6||this.head.type===8){let t=[];for(let n of this.head.value)if(n===" ")r.keepSpaces&&t.push(new s(6,n));else if(n===`
`)t.push(new s(1,n));else throw new Oe(`Unexpected whitespace character: ${n}`,this);return t}return[this.head]}},J=class extends _{items;constructor(e){super("group",s.NONE),this.items=e}isOverHigh(){return this.items.some(e=>e.isOverHigh())}serialize(e,r){let t=this.items.flatMap(n=>n.serialize(e,r));return t.length>0&&t[0].eq(A)&&t.shift(),t.length>0&&t[t.length-1].eq(A)&&t.pop(),t}},F=class extends _{base;sup;sub;constructor(e){super("supsub",s.NONE),this.base=e.base,this.sup=e.sup,this.sub=e.sub}isOverHigh(){return this.base.isOverHigh()}serialize(e,r){let t=[],{base:n,sup:a,sub:i}=this;t.push(...n.serialize(e,r));let l=a&&a.head.eq(new s(2,"'"));return l&&t.push(new s(2,"'")),i&&(t.push(new s(2,"_")),t.push(...i.serialize(e,r))),a&&!l&&(t.push(new s(2,"^")),t.push(...a.serialize(e,r))),t.push(A),t}},m=class extends _{args;constructor(e,r){super("funcCall",e),this.args=r}isOverHigh(){return this.head.value==="frac"?!0:this.args.some(e=>e.isOverHigh())}serialize(e,r){let t=[],n=this.head;t.push(n),e.insideFunctionDepth++,t.push(L);for(let a=0;a<this.args.length;a++)t.push(...this.args[a].serialize(e,r)),a<this.args.length-1&&t.push(new s(2,","));if(this.options)for(let[a,i]of Object.entries(this.options))t.push(new s(3,`, ${a}: ${i.toString()}`));return t.push(D),e.insideFunctionDepth--,t}},ze=class extends _{args;constructor(e){super("fraction",s.NONE),this.args=e}isOverHigh(){return!0}serialize(e,r){let t=[],[n,a]=this.args;return t.push(A),t.push(...n.serialize(e,r)),t.push(new s(2,"/")),t.push(...a.serialize(e,r)),t.push(A),t}},L=new s(2,"("),D=new s(2,")"),I=class extends _{body;left;right;constructor(e,r){super("leftright",e),this.body=r.body,this.left=r.left,this.right=r.right}isOverHigh(){return this.body.isOverHigh()}serialize(e,r){let t=[],n=new s(1,"lr"),{left:a,right:i}=this;return this.head.eq(n)&&(t.push(n),t.push(L)),a&&t.push(a),t.push(...this.body.serialize(e,r)),i&&t.push(i),this.head.eq(n)&&t.push(D),t}},q=class $ extends _{matrix;constructor(r,t){super("matrixLike",r),this.matrix=t}isOverHigh(){return!0}serialize(r,t){let n=[],a,i;if(this.head.eq($.MAT)?(a=new s(2,","),i=new s(2,";")):this.head.eq($.CASES)?(a=new s(2,"&"),i=new s(2,",")):this.head.eq(s.NONE)&&(a=new s(2,"&"),i=new s(1,"\\")),!this.head.eq(s.NONE)&&(n.push(this.head),r.insideFunctionDepth++,n.push(L),this.options))for(let[l,u]of Object.entries(this.options))n.push(new s(3,`${l}: ${u.toString()}, `));return this.matrix.forEach((l,u)=>{l.forEach((c,h)=>{n.push(...c.serialize(r,t)),h<l.length-1?n.push(a):u<this.matrix.length-1&&n.push(i)})}),this.head.eq(s.NONE)||(n.push(D),r.insideFunctionDepth--),n}static MAT=new s(1,"mat");static CASES=new s(1,"cases")},Le=class extends _{fragments;constructor(e,r){super("markupFunc",e),this.fragments=r}isOverHigh(){return this.fragments.some(e=>e.isOverHigh())}serialize(e,r){let t=[];if(t.push(this.head),e.insideFunctionDepth++,t.push(L),this.options){let n=Object.entries(this.options);for(let a=0;a<n.length;a++){let[i,l]=n[a];t.push(new s(3,`${i}: ${l.toString()}`)),a<n.length-1&&t.push(new s(2,","))}}t.push(D),t.push(new s(3,"["));for(let n of this.fragments)t.push(new s(3,"$")),t.push(...n.serialize(e,r)),t.push(new s(3,"$"));return t.push(new s(3,"]")),t}},De=new s(2,"("),Re=new s(2,")"),Be=new s(2,","),ee=new s(1,`
`),B=new s(7," "),Pe=class{buffer="";queue=[];options;constructor(e){this.options=e}writeBuffer(e,r){let t=r.toString();if(t==="")return;let n=!1;n||=/[\(\[\|]$/.test(this.buffer)&&/^\w/.test(t),n||=/^[})\]\|]$/.test(t),n||=/[^=]$/.test(this.buffer)&&t==="(",n||=/^[_^,;!]$/.test(t),n||=t==="'",n||=/[\(\[{]\s*(-|\+)$/.test(this.buffer)||this.buffer==="-"||this.buffer==="+",n||=t.startsWith(`
`),n||=this.buffer==="",n||=/\s$/.test(this.buffer)||/^\s/.test(t),n||=this.buffer.endsWith("&")&&t==="=",n||=this.buffer.endsWith("/")||t==="/",n||=r.type===3,n||=/[\s_^{\(]$/.test(this.buffer),e!==null&&(n||=e.type===3),n||(this.buffer+=" "),this.buffer+=t}serialize(e){let r={insideFunctionDepth:0};this.queue.push(...e.serialize(r,this.options))}flushQueue(){let e=[];for(let t of this.queue)t.eq(B)&&e.length>0&&e[e.length-1].eq(B)||e.push(t);let r=new s(1,"");for(let t=0;t<e.length;t++)e[t].eq(B)&&(t===0||t===e.length-1||e[t-1].type===6||e[t-1].isOneOf([De,ee])||e[t+1].isOneOf([Re,Be,ee]))&&(e[t]=r);e=e.filter(t=>!t.eq(r));for(let t=0;t<e.length;t++){let n=e[t],a=t===0?null:e[t-1];this.writeBuffer(a,n)}this.queue=[]}finalize(){this.flushQueue();let e=function(n){let a=n.replace(/floor\.l\s*(.*?)\s*floor\.r/g,"floor($1)");return a=a.replace(/floor\(\)/g,'floor("")'),a},r=function(n){let a=n.replace(/ceil\.l\s*(.*?)\s*ceil\.r/g,"ceil($1)");return a=a.replace(/ceil\(\)/g,'ceil("")'),a},t=function(n){let a=n.replace(/floor\.l\s*(.*?)\s*ceil\.r/g,"round($1)");return a=a.replace(/round\(\)/g,'round("")'),a};if(this.options.optimize){let n=[e,r,t];for(let a of n)this.buffer=a(this.buffer)}return this.buffer}},b=new Map([["displaystyle","display"],["textstyle","inline"],["hspace","#h"],["|","bar.v.double"],[",","thin"],[":","med"],[" ","med"],[";","thick"],["ln","ln"],["log","log"],["cos","cos"],["sin","sin"],["tan","tan"],["cot","cot"],["sec","sec"],["csc","csc"],["mod","mod"],["omicron","omicron"],["Xi","Xi"],["Upsilon","Upsilon"],["lim","lim"],["binom","binom"],["tilde","tilde"],["hat","hat"],["sqrt","sqrt"],["nonumber",""],["vec","arrow"],["neq","eq.not"],["dot","dot"],["ddot","dot.double"],["doteq","dot(eq)"],["dots","dots.h"],["vdots","dots.v"],["ddots","dots.down"],["widehat","hat"],["widetilde","tilde"],["quad","quad"],["qquad","wide"],["overbrace","overbrace"],["underbrace","underbrace"],["overline","overline"],["underline","underline"],["bar","macron"],["dbinom","binom"],["tbinom","binom"],["dfrac","frac"],["tfrac","frac"],["operatorname","op"],["boldsymbol","bold"],["mathbb","bb"],["mathbf","bold"],["mathcal","cal"],["mathscr","scr"],["mathit","italic"],["mathfrak","frak"],["mathrm","upright"],["mathsf","sans"],["mathtt","mono"],["rm","upright"],["pmb","bold"],["leadsto","arrow.r.squiggly"],["P","pilcrow"],["S","section"],["aleph","alef"],["infin","infinity"],["Delta","Delta"],["Gamma","Gamma"],["Lambda","Lambda"],["Omega","Omega"],["Phi","Phi"],["Pi","Pi"],["Psi","Psi"],["Sigma","Sigma"],["Theta","Theta"],["alpha","alpha"],["beta","beta"],["bigcirc","circle.big"],["bullet","bullet"],["cdot","dot.op"],["cdots","dots.c"],["checkmark","checkmark"],["chi","chi"],["circ","circle.small"],["colon","colon"],["cong","tilde.equiv"],["coprod","product.co"],["copyright","copyright"],["cup","union"],["curlyvee","or.curly"],["curlywedge","and.curly"],["dagger","dagger"],["dashv","tack.l"],["ddagger","dagger.double"],["delta","delta"],["ddots","dots.down"],["diamond","diamond"],["div","div"],["divideontimes","times.div"],["dotplus","plus.dot"],["ell","ell"],["emptyset","nothing"],["epsilon","epsilon.alt"],["equiv","equiv"],["eta","eta"],["exists","exists"],["forall","forall"],["gamma","gamma"],["ge","gt.eq"],["geq","gt.eq"],["geqslant","gt.eq.slant"],["gg","gt.double"],["hbar","planck.reduce"],["imath","dotless.i"],["iiiint","integral.quad"],["iiint","integral.triple"],["iint","integral.double"],["in","in"],["infty","infinity"],["int","integral"],["intercal","top"],["iota","iota"],["jmath","dotless.j"],["kappa","kappa"],["lambda","lambda"],["land","and"],["langle","angle.l"],["lbrace","brace.l"],["lbrack","bracket.l"],["ldots","dots.h"],["le","lt.eq"],["leftthreetimes","times.three.l"],["leftrightarrow","arrow.l.r"],["leq","lt.eq"],["leqslant","lt.eq.slant"],["lhd","triangle.l"],["ll","lt.double"],["lor","or"],["ltimes","times.l"],["measuredangle","angle.arc"],["mid","divides"],["models","models"],["mp","minus.plus"],["mu","mu"],["nabla","nabla"],["ncong","tilde.equiv.not"],["ne","eq.not"],["neg","not"],["neq","eq.not"],["nexists","exists.not"],["ni","in.rev"],["nleftarrow","arrow.l.not"],["nleq","lt.eq.not"],["nparallel","parallel.not"],["ngeq","gt.eq.not"],["nmid","divides.not"],["notin","in.not"],["nsim","tilde.not"],["nsubseteq","subset.eq.not"],["nu","nu"],["ntriangleleft","lt.tri.not"],["ntriangleright","gt.tri.not"],["odot","dot.circle"],["oint","integral.cont"],["oiint","integral.surf"],["oiiint","integral.vol"],["omega","omega"],["ominus","minus.circle"],["otimes","times.circle"],["parallel","parallel"],["partial","diff"],["perp","perp"],["phi","phi.alt"],["pi","pi"],["pm","plus.minus"],["pounds","pound"],["prec","prec"],["preceq","prec.eq"],["prime","prime"],["prod","product"],["propto","prop"],["psi","psi"],["rangle","angle.r"],["rbrace","brace.r"],["rbrack","bracket.r"],["rhd","triangle"],["rho","rho"],["rightarrow","arrow.r"],["rightthreetimes","times.three.r"],["rtimes","times.r"],["setminus","without"],["sigma","sigma"],["sim","tilde.op"],["simeq","tilde.eq"],["slash","slash"],["smallsetminus","without"],["spadesuit","suit.spade"],["sqsubseteq","subset.eq.sq"],["sqsupseteq","supset.eq.sq"],["subset","subset"],["subseteq","subset.eq"],["subsetneq","subset.neq"],["succ","succ"],["succeq","succ.eq"],["sum","sum"],["supset","supset"],["supseteq","supset.eq"],["supsetneq","supset.neq"],["tau","tau"],["theta","theta"],["times","times"],["to","arrow.r"],["top","top"],["triangle","triangle.t"],["twoheadrightarrow","arrow.r.twohead"],["upharpoonright","harpoon.tr"],["uplus","union.plus"],["upsilon","upsilon"],["varepsilon","epsilon"],["varnothing","diameter"],["varphi","phi"],["varpi","pi.alt"],["varrho","rho.alt"],["varsigma","sigma.alt"],["vartheta","theta.alt"],["vdash","tack.r"],["vdots","dots.v"],["vee","or"],["wedge","and"],["wr","wreath"],["xi","xi"],["yen","yen"],["zeta","zeta"],["intop","limits(integral)"],["LaTeX","#LaTeX"],["TeX","#TeX"]]),Ue=new Map([["acwopencirclearrow","arrow.ccw"],["adots","dots.up"],["angdnr","angle.acute"],["angle","angle"],["angles","angle.s"],["approx","approx"],["approxeq","approx.eq"],["approxident","tilde.triple"],["assert","tack.r.short"],["ast","ast.op"],["asymp","asymp"],["awint","integral.ccw"],["backcong","tilde.rev.equiv"],["backdprime","prime.double.rev"],["backprime","prime.rev"],["backsim","tilde.rev"],["backsimeq","tilde.eq.rev"],["backslash","backslash"],["backtrprime","prime.triple.rev"],["bardownharpoonleft","harpoon.bl.bar"],["bardownharpoonright","harpoon.br.bar"],["barleftarrow","arrow.l.stop"],["barleftarrowrightarrowbar","arrows.lr.stop"],["barleftharpoondown","harpoon.lb.stop"],["barleftharpoonup","harpoon.lt.stop"],["barrightharpoondown","harpoon.rb.bar"],["barrightharpoonup","harpoon.rt.bar"],["baruparrow","arrow.t.stop"],["barupharpoonleft","harpoon.tl.stop"],["barupharpoonright","harpoon.tr.stop"],["barV","tack.b.double"],["BbbA","AA"],["BbbB","BB"],["BbbC","CC"],["BbbD","DD"],["BbbE","EE"],["BbbF","FF"],["BbbG","GG"],["BbbH","HH"],["BbbI","II"],["BbbJ","JJ"],["BbbK","KK"],["BbbL","LL"],["BbbM","MM"],["BbbN","NN"],["BbbO","OO"],["BbbP","PP"],["BbbQ","QQ"],["BbbR","RR"],["BbbS","SS"],["BbbT","TT"],["BbbU","UU"],["BbbV","VV"],["BbbW","WW"],["BbbX","XX"],["BbbY","YY"],["BbbZ","ZZ"],["because","because"],["bigblacktriangledown","triangle.filled.b"],["bigblacktriangleup","triangle.filled.t"],["bigbot","tack.t.big"],["bigcap","inter.big"],["bigcup","union.big"],["bigcupdot","union.dot.big"],["biginterleave","interleave.big"],["bigodot","dot.circle.big"],["bigoplus","plus.circle.big"],["bigotimes","times.circle.big"],["bigsqcap","inter.sq.big"],["bigsqcup","union.sq.big"],["bigstar","star.filled"],["bigtimes","times.big"],["bigtop","tack.b.big"],["bigtriangledown","triangle.stroked.b"],["bigtriangleup","triangle.stroked.t"],["biguplus","union.plus.big"],["bigvee","or.big"],["bigwedge","and.big"],["bigwhitestar","star.stroked"],["blackhourglass","hourglass.filled"],["blacktriangle","triangle.filled.small.t"],["blacktriangledown","triangle.filled.small.b"],["blacktriangleleft","triangle.filled.l"],["blacktriangleright","triangle.filled.r"],["blkhorzoval","ellipse.filled.h"],["blkvertoval","ellipse.filled.v"],["bot","bot"],["boxast","ast.square"],["boxdot","dot.square"],["boxminus","minus.square"],["boxplus","plus.square"],["boxtimes","times.square"],["cap","inter"],["Cap","inter.double"],["capdot","inter.dot"],["capwedge","inter.and"],["caretinsert","caret"],["cdot","dot.op"],["cdotp","dot.c"],["checkmark","checkmark"],["circledast","ast.circle"],["circledcirc","circle.nested"],["circleddash","dash.circle"],["circledequal","eq.circle"],["circledparallel","parallel.circle"],["circledvert","bar.v.circle"],["clubsuit","suit.club.filled"],["Colon","colon.double"],["coloneq","colon.eq"],["Coloneq","colon.double.eq"],["complement","complement"],["cong","tilde.equiv"],["coprod","product.co"],["cup","union"],["Cup","union.double"],["cupdot","union.dot"],["cupleftarrow","union.arrow"],["cupvee","union.or"],["curlyeqprec","eq.prec"],["curlyeqsucc","eq.succ"],["curlyvee","or.curly"],["curlywedge","and.curly"],["curvearrowleft","arrow.ccw.half"],["curvearrowright","arrow.cw.half"],["cwopencirclearrow","arrow.cw"],["dagger","dagger"],["dashcolon","dash.colon"],["dashv","tack.l"],["Dashv","tack.l.double"],["dashVdash","tack.l.r"],["ddagger","dagger.double"],["ddddot","dot.quad"],["dddot","dot.triple"],["ddots","dots.down"],["DDownarrow","arrow.b.quad"],["Ddownarrow","arrow.b.triple"],["diameter","diameter"],["diamondcdot","diamond.stroked.dot"],["diamondsuit","suit.diamond.stroked"],["dicei","die.one"],["diceii","die.two"],["diceiii","die.three"],["diceiv","die.four"],["dicev","die.five"],["dicevi","die.six"],["div","div"],["divideontimes","times.div"],["Doteq","eq.dots"],["dotminus","minus.dot"],["dotplus","plus.dot"],["dotsim","tilde.dot"],["dottedcircle","circle.dotted"],["dottedsquare","square.stroked.dotted"],["doubleplus","plus.double"],["downarrow","arrow.b"],["Downarrow","arrow.b.double"],["downarrowbar","arrow.b.stop"],["downdasharrow","arrow.b.dashed"],["downdownarrows","arrows.bb"],["downharpoonleft","harpoon.bl"],["downharpoonleftbar","harpoon.bl.stop"],["downharpoonright","harpoon.br"],["downharpoonrightbar","harpoon.br.stop"],["downharpoonsleftright","harpoons.blbr"],["downrightcurvedarrow","arrow.b.curve"],["downuparrows","arrows.bt"],["downupharpoonsleftright","harpoons.bltr"],["downwhitearrow","arrow.b.stroked"],["downzigzagarrow","arrow.zigzag"],["dprime","prime.double"],["dualmap","multimap.double"],["eighthnote","note.eighth.alt"],["ell","ell"],["emptysetoarr","emptyset.arrow.r"],["emptysetoarrl","emptyset.arrow.l"],["emptysetobar","emptyset.bar"],["emptysetocirc","emptyset.circle"],["eparsl","parallel.slanted.eq"],["eqcolon","eq.colon"],["eqdef","eq.def"],["eqgtr","eq.gt"],["eqless","eq.lt"],["eqsim","minus.tilde"],["equal","eq"],["equalparallel","parallel.eq"],["equiv","eq.triple"],["Equiv","eq.quad"],["equivVert","parallel.equiv"],["eqvparsl","parallel.slanted.equiv"],["errbarblackcircle","errorbar.circle.filled"],["errbarblackdiamond","errorbar.diamond.filled"],["errbarblacksquare","errorbar.square.filled"],["errbarcircle","errorbar.circle.stroked"],["errbardiamond","errorbar.diamond.stroked"],["errbarsquare","errorbar.square.stroked"],["euro","euro"],["Exclam","excl.double"],["exists","exists"],["fallingdotseq","eq.dots.down"],["fint","integral.slash"],["flat","flat"],["forall","forall"],["fourvdots","fence.dotted"],["fullouterjoin","join.l.r"],["geq","gt.eq"],["geqq","gt.equiv"],["geqslant","gt.eq.slant"],["gg","gt.double"],["ggg","gt.triple"],["gggnest","gt.triple.nested"],["gnapprox","gt.napprox"],["gneq","gt.neq"],["gneqq","gt.nequiv"],["gnsim","gt.ntilde"],["greater","gt"],["gtlpar","angle.spheric.rev"],["gtrapprox","gt.approx"],["gtrdot","gt.dot"],["gtreqless","gt.eq.lt"],["gtrless","gt.lt"],["gtrsim","gt.tilde"],["heartsuit","suit.heart.stroked"],["hknearrow","arrow.tr.hook"],["hknwarrow","arrow.tl.hook"],["hksearrow","arrow.br.hook"],["hkswarrow","arrow.bl.hook"],["hookleftarrow","arrow.l.hook"],["hookrightarrow","arrow.r.hook"],["horizbar","bar.h"],["hourglass","hourglass.stroked"],["hrectangle","rect.stroked.h"],["hrectangleblack","rect.filled.h"],["hslash","planck.reduce"],["hzigzag","dash.wave.double"],["iiiint","integral.quad"],["iiint","integral.triple"],["iinfin","infinity.incomplete"],["iint","integral.double"],["Im","Im"],["imageof","image"],["in","in"],["increment","laplace"],["infty","infinity"],["int","integral"],["intbar","integral.dash"],["intBar","integral.dash.double"],["intcap","integral.inter"],["intclockwise","integral.cw"],["intcup","integral.union"],["interleave","interleave"],["intlarhk","integral.arrow.hook"],["intx","integral.times"],["Join","join"],["langle","angle.l"],["lAngle","angle.l.double"],["langledot","angle.l.dot"],["lat","lat"],["late","lat.eq"],["lbrace","brace.l"],["lBrace","brace.l.double"],["lbrack","bracket.l"],["lBrack","bracket.l.double"],["lbrbrak","shell.l"],["Lbrbrak","shell.l.double"],["lceil","ceil.l"],["lcurvyangle","angle.l.curly"],["leftarrow","arrow.l"],["Leftarrow","arrow.l.double"],["leftarrowtail","arrow.l.tail"],["leftdasharrow","arrow.l.dashed"],["leftdotarrow","arrow.l.dotted"],["leftdowncurvedarrow","arrow.l.curve"],["leftharpoondown","harpoon.lb"],["leftharpoondownbar","harpoon.lb.bar"],["leftharpoonsupdown","harpoons.ltlb"],["leftharpoonup","harpoon.lt"],["leftharpoonupbar","harpoon.lt.bar"],["leftleftarrows","arrows.ll"],["leftouterjoin","join.l"],["leftrightarrow","arrow.l.r"],["Leftrightarrow","arrow.l.r.double"],["leftrightarrows","arrows.lr"],["leftrightharpoondowndown","harpoon.lb.rb"],["leftrightharpoondownup","harpoon.lb.rt"],["leftrightharpoons","harpoons.ltrb"],["leftrightharpoonsdown","harpoons.lbrb"],["leftrightharpoonsup","harpoons.ltrt"],["leftrightharpoonupdown","harpoon.lt.rb"],["leftrightharpoonupup","harpoon.lt.rt"],["leftrightsquigarrow","arrow.l.r.wave"],["leftsquigarrow","arrow.l.squiggly"],["leftthreearrows","arrows.lll"],["leftthreetimes","times.three.l"],["leftwavearrow","arrow.l.wave"],["leftwhitearrow","arrow.l.stroked"],["leq","lt.eq"],["leqq","lt.equiv"],["leqslant","lt.eq.slant"],["less","lt"],["lessapprox","lt.approx"],["lessdot","lt.dot"],["lesseqgtr","lt.eq.gt"],["lessgtr","lt.gt"],["lesssim","lt.tilde"],["lfloor","floor.l"],["lgblkcircle","circle.filled.big"],["lgblksquare","square.filled.big"],["lgwhtcircle","circle.stroked.big"],["lgwhtsquare","square.stroked.big"],["ll","lt.double"],["llblacktriangle","triangle.filled.bl"],["LLeftarrow","arrow.l.quad"],["Lleftarrow","arrow.l.triple"],["lll","lt.triple"],["lllnest","lt.triple.nested"],["lltriangle","triangle.stroked.bl"],["lnapprox","lt.napprox"],["lneq","lt.neq"],["lneqq","lt.nequiv"],["lnsim","lt.ntilde"],["longdashv","tack.l.long"],["Longleftarrow","arrow.l.double.long"],["longleftarrow","arrow.l.long"],["Longleftrightarrow","arrow.l.r.double.long"],["longleftrightarrow","arrow.l.r.long"],["longleftsquigarrow","arrow.l.long.squiggly"],["Longmapsfrom","arrow.l.double.long.bar"],["longmapsfrom","arrow.l.long.bar"],["longmapsto","arrow.r.long.bar"],["Longmapsto","arrow.r.double.long.bar"],["Longrightarrow","arrow.r.double.long"],["longrightarrow","arrow.r.long"],["longrightsquigarrow","arrow.r.long.squiggly"],["looparrowleft","arrow.l.loop"],["looparrowright","arrow.r.loop"],["lparen","paren.l"],["lParen","paren.l.double"],["lrblacktriangle","triangle.filled.br"],["lrtriangle","triangle.stroked.br"],["ltimes","times.l"],["lvzigzag","fence.l"],["Lvzigzag","fence.l.double"],["maltese","maltese"],["mapsdown","arrow.b.bar"],["mapsfrom","arrow.l.bar"],["Mapsfrom","arrow.l.double.bar"],["mapsto","arrow.r.bar"],["Mapsto","arrow.r.double.bar"],["mapsup","arrow.t.bar"],["mathampersand","amp"],["mathatsign","at"],["mathcolon","colon"],["mathcomma","comma"],["mathdollar","dollar"],["mathexclam","excl"],["mathoctothorpe","hash"],["mathparagraph","pilcrow"],["mathpercent","percent"],["mathperiod","dot.basic"],["mathplus","plus"],["mathquestion","quest"],["mathratio","ratio"],["mathsection","section"],["mathsemicolon","semi"],["mathslash","slash"],["mathsterling","pound"],["mathyen","yen"],["mdblkdiamond","diamond.filled.medium"],["mdblklozenge","lozenge.filled.medium"],["mdblksquare","square.filled.medium"],["mdlgblkcircle","circle.filled"],["mdlgblkdiamond","diamond.filled"],["mdlgblklozenge","lozenge.filled"],["mdlgblksquare","square.filled"],["mdlgwhtcircle","circle.stroked"],["mdlgwhtdiamond","diamond.stroked"],["mdlgwhtlozenge","lozenge.stroked"],["mdlgwhtsquare","square.stroked"],["mdsmblkcircle","circle.filled.tiny"],["mdsmblksquare","square.filled.small"],["mdsmwhtcircle","circle.stroked.small"],["mdsmwhtsquare","square.stroked.small"],["mdwhtdiamond","diamond.stroked.medium"],["mdwhtlozenge","lozenge.stroked.medium"],["mdwhtsquare","square.stroked.medium"],["measeq","eq.m"],["measuredangle","angle.arc"],["measuredangleleft","angle.arc.rev"],["measuredrightangle","angle.right.arc"],["mho","Omega.inv"],["mid","divides"],["minus","minus"],["models","models"],["mp","minus.plus"],["multimap","multimap"],["nabla","gradient"],["napprox","approx.not"],["nasymp","asymp.not"],["natural","natural"],["ncong","tilde.equiv.not"],["ne","eq.not"],["nearrow","arrow.tr"],["Nearrow","arrow.tr.double"],["neg","not"],["nequiv","equiv.not"],["neswarrow","arrow.tr.bl"],["nexists","exists.not"],["ngeq","gt.eq.not"],["ngtr","gt.not"],["ngtrless","gt.lt.not"],["ngtrsim","gt.tilde.not"],["nhpar","parallel.struck"],["nhVvert","interleave.struck"],["ni","in.rev"],["nLeftarrow","arrow.l.double.not"],["nleftarrow","arrow.l.not"],["nLeftrightarrow","arrow.l.r.double.not"],["nleftrightarrow","arrow.l.r.not"],["nleq","lt.eq.not"],["nless","lt.not"],["nlessgtr","lt.gt.not"],["nlesssim","lt.tilde.not"],["nmid","divides.not"],["nni","in.rev.not"],["notin","in.not"],["nparallel","parallel.not"],["nprec","prec.not"],["npreccurlyeq","prec.curly.eq.not"],["nRightarrow","arrow.r.double.not"],["nrightarrow","arrow.r.not"],["nsim","tilde.not"],["nsimeq","tilde.eq.not"],["nsqsubseteq","subset.eq.sq.not"],["nsqsupseteq","supset.eq.sq.not"],["nsubset","subset.not"],["nsubseteq","subset.eq.not"],["nsucc","succ.not"],["nsucccurlyeq","succ.curly.eq.not"],["nsupset","supset.not"],["nsupseteq","supset.eq.not"],["ntrianglelefteq","lt.tri.eq.not"],["ntrianglerighteq","gt.tri.eq.not"],["nvartriangleleft","lt.tri.not"],["nvartriangleright","gt.tri.not"],["nVdash","forces.not"],["nvdash","tack.r.not"],["nvDash","tack.r.double.not"],["nvinfty","infinity.bar"],["nwarrow","arrow.tl"],["Nwarrow","arrow.tl.double"],["nwsearrow","arrow.tl.br"],["obrbrak","shell.t"],["obslash","backslash.circle"],["odiv","div.circle"],["odot","dot.circle"],["ogreaterthan","gt.circle"],["oiiint","integral.vol"],["oiint","integral.surf"],["oint","integral.cont"],["ointctrclockwise","integral.cont.ccw"],["olessthan","lt.circle"],["ominus","minus.circle"],["operp","perp.circle"],["oplus","plus.circle"],["origof","original"],["otimes","times.circle"],["overbracket","bracket.t"],["overparen","paren.t"],["parallel","parallel"],["parallelogram","parallelogram.stroked"],["parallelogramblack","parallelogram.filled"],["parsim","parallel.tilde"],["partial","diff"],["pentagon","penta.stroked"],["pentagonblack","penta.filled"],["perp","perp"],["Planckconst","planck"],["pm","plus.minus"],["prec","prec"],["Prec","prec.double"],["precapprox","prec.approx"],["preccurlyeq","prec.curly.eq"],["preceq","prec.eq"],["preceqq","prec.equiv"],["precnapprox","prec.napprox"],["precneq","prec.neq"],["precneqq","prec.nequiv"],["precnsim","prec.ntilde"],["precsim","prec.tilde"],["prime","prime"],["prod","product"],["propto","prop"],["QED","qed"],["qprime","prime.quad"],["quarternote","note.quarter.alt"],["questeq","eq.quest"],["Question","quest.double"],["rangle","angle.r"],["rAngle","angle.r.double"],["rangledot","angle.r.dot"],["rbrace","brace.r"],["rBrace","brace.r.double"],["rbrack","bracket.r"],["rBrack","bracket.r.double"],["rbrbrak","shell.r"],["Rbrbrak","shell.r.double"],["rceil","ceil.r"],["rcurvyangle","angle.r.curly"],["Re","Re"],["revangle","angle.rev"],["revemptyset","emptyset.rev"],["revnmid","divides.not.rev"],["rfloor","floor.r"],["rightangle","angle.right"],["rightanglemdot","angle.right.dot"],["rightanglesqr","angle.right.sq"],["rightarrow","arrow.r"],["Rightarrow","arrow.r.double"],["rightarrowbar","arrow.r.stop"],["rightarrowonoplus","plus.circle.arrow"],["rightarrowtail","arrow.r.tail"],["rightdasharrow","arrow.r.dashed"],["rightdotarrow","arrow.r.dotted"],["rightdowncurvedarrow","arrow.r.curve"],["rightharpoondown","harpoon.rb"],["rightharpoondownbar","harpoon.rb.stop"],["rightharpoonsupdown","harpoons.rtrb"],["rightharpoonup","harpoon.rt"],["rightharpoonupbar","harpoon.rt.stop"],["rightleftarrows","arrows.rl"],["rightleftharpoons","harpoons.rtlb"],["rightleftharpoonsdown","harpoons.rblb"],["rightleftharpoonsup","harpoons.rtlt"],["rightouterjoin","join.r"],["rightrightarrows","arrows.rr"],["rightsquigarrow","arrow.r.squiggly"],["rightthreearrows","arrows.rrr"],["rightthreetimes","times.three.r"],["rightwavearrow","arrow.r.wave"],["rightwhitearrow","arrow.r.stroked"],["risingdotseq","eq.dots.up"],["rparen","paren.r"],["rParen","paren.r.double"],["RRightarrow","arrow.r.quad"],["Rrightarrow","arrow.r.triple"],["rsolbar","backslash.not"],["rtimes","times.r"],["rvzigzag","fence.r"],["Rvzigzag","fence.r.double"],["searrow","arrow.br"],["Searrow","arrow.br.double"],["setminus","without"],["sharp","sharp"],["shortdowntack","tack.b.short"],["shortlefttack","tack.l.short"],["shortuptack","tack.t.short"],["sim","tilde.op"],["sime","tilde.eq"],["similarleftarrow","arrow.l.tilde"],["similarrightarrow","arrow.r.tilde"],["simneqq","tilde.nequiv"],["smallblacktriangleleft","triangle.filled.small.l"],["smallblacktriangleright","triangle.filled.small.r"],["smallin","in.small"],["smallni","in.rev.small"],["smalltriangleleft","triangle.stroked.small.l"],["smalltriangleright","triangle.stroked.small.r"],["smashtimes","smash"],["smblkcircle","bullet"],["smblkdiamond","diamond.filled.small"],["smblklozenge","lozenge.filled.small"],["smblksquare","square.filled.tiny"],["smeparsl","parallel.slanted.eq.tilde"],["smt","smt"],["smte","smt.eq"],["smwhtdiamond","diamond.stroked.small"],["smwhtlozenge","lozenge.stroked.small"],["smwhtsquare","square.stroked.tiny"],["spadesuit","suit.spade.filled"],["sphericalangle","angle.spheric"],["sphericalangleup","angle.spheric.top"],["sqcap","inter.sq"],["Sqcap","inter.sq.double"],["sqcup","union.sq"],["Sqcup","union.sq.double"],["sqint","integral.square"],["sqsubset","subset.sq"],["sqsubseteq","subset.eq.sq"],["sqsubsetneq","subset.sq.neq"],["sqsupset","supset.sq"],["sqsupseteq","supset.eq.sq"],["sqsupsetneq","supset.sq.neq"],["squoval","square.stroked.rounded"],["sslash","slash.double"],["star","star.op"],["stareq","eq.star"],["subset","subset"],["Subset","subset.double"],["subsetdot","subset.dot"],["subseteq","subset.eq"],["subsetneq","subset.neq"],["succ","succ"],["Succ","succ.double"],["succapprox","succ.approx"],["succcurlyeq","succ.curly.eq"],["succeq","succ.eq"],["succeqq","succ.equiv"],["succnapprox","succ.napprox"],["succneq","succ.neq"],["succneqq","succ.nequiv"],["succnsim","succ.ntilde"],["succsim","succ.tilde"],["sum","sum"],["sumint","sum.integral"],["supset","supset"],["Supset","supset.double"],["supsetdot","supset.dot"],["supseteq","supset.eq"],["supsetneq","supset.neq"],["swarrow","arrow.bl"],["Swarrow","arrow.bl.double"],["therefore","therefore"],["threedangle","angle.spatial"],["threedotcolon","colon.tri.op"],["tieinfty","infinity.tie"],["times","times"],["tminus","miny"],["top","tack.b"],["tplus","tiny"],["trianglecdot","triangle.stroked.dot"],["triangledown","triangle.stroked.small.b"],["triangleleft","triangle.stroked.l"],["trianglelefteq","lt.tri.eq"],["triangleminus","minus.triangle"],["triangleplus","plus.triangle"],["triangleq","eq.delta"],["triangleright","triangle.stroked.r"],["trianglerighteq","gt.tri.eq"],["triangletimes","times.triangle"],["tripleplus","plus.triple"],["trprime","prime.triple"],["trslash","slash.triple"],["twoheaddownarrow","arrow.b.twohead"],["twoheadleftarrow","arrow.l.twohead"],["twoheadmapsfrom","arrow.l.twohead.bar"],["twoheadmapsto","arrow.r.twohead.bar"],["twoheadrightarrow","arrow.r.twohead"],["twoheaduparrow","arrow.t.twohead"],["twonotes","note.eighth.beamed"],["ubrbrak","shell.b"],["ulblacktriangle","triangle.filled.tl"],["ultriangle","triangle.stroked.tl"],["uminus","union.minus"],["underbrace","brace.b"],["underbracket","bracket.b"],["underparen","paren.b"],["unicodecdots","dots.h.c"],["unicodeellipsis","dots.h"],["upand","amp.inv"],["uparrow","arrow.t"],["Uparrow","arrow.t.double"],["updasharrow","arrow.t.dashed"],["updownarrow","arrow.t.b"],["Updownarrow","arrow.t.b.double"],["updownarrows","arrows.tb"],["updownharpoonleftleft","harpoon.tl.bl"],["updownharpoonleftright","harpoon.tl.br"],["updownharpoonrightleft","harpoon.tr.bl"],["updownharpoonrightright","harpoon.tr.br"],["updownharpoonsleftright","harpoons.tlbr"],["upharpoonleft","harpoon.tl"],["upharpoonleftbar","harpoon.tl.bar"],["upharpoonright","harpoon.tr"],["upharpoonrightbar","harpoon.tr.bar"],["upharpoonsleftright","harpoons.tltr"],["uplus","union.plus"],["uprightcurvearrow","arrow.t.curve"],["upuparrows","arrows.tt"],["upwhitearrow","arrow.t.stroked"],["urblacktriangle","triangle.filled.tr"],["urtriangle","triangle.stroked.tr"],["UUparrow","arrow.t.quad"],["Uuparrow","arrow.t.triple"],["varclubsuit","suit.club.stroked"],["vardiamondsuit","suit.diamond.filled"],["varheartsuit","suit.heart.filled"],["varhexagon","hexa.stroked"],["varhexagonblack","hexa.filled"],["varnothing","emptyset"],["varointclockwise","integral.cont.cw"],["varspadesuit","suit.spade.stroked"],["vartriangle","triangle.stroked.small.t"],["vartriangleleft","lt.tri"],["vartriangleright","gt.tri"],["Vbar","tack.t.double"],["Vdash","forces"],["vdash","tack.r"],["vDash","tack.r.double"],["vdots","dots.v"],["vee","or"],["Vee","or.double"],["veedot","or.dot"],["veeeq","eq.equi"],["vert","bar.v"],["Vert","bar.v.double"],["vlongdash","tack.r.long"],["vrectangle","rect.stroked.v"],["vrectangleblack","rect.filled.v"],["Vvert","bar.v.triple"],["vysmblkcircle","circle.filled.small"],["vysmwhtcircle","circle.stroked.tiny"],["wedge","and"],["Wedge","and.double"],["wedgedot","and.dot"],["wedgeq","eq.est"],["whiteinwhitetriangle","triangle.stroked.nested"],["whthorzoval","ellipse.stroked.h"],["whtvertoval","ellipse.stroked.v"],["wideangledown","angle.oblique"],["wr","wreath"],["xsol","slash.big"]]),He=new Map([["gets","leftarrow"],["iff","Longleftrightarrow"],["implies","Longrightarrow"]]);for(let[e,r]of Ue)b.has(e)||b.set(e,r);var G=new Map;for(let[e,r]of Array.from(b.entries()).reverse())G.set(r,e);G.set("oo","infty");var Ie=new Map([["top","top"],["frac","frac"],["tilde","tilde"],["hat","hat"],["upright","mathrm"],["bold","boldsymbol"],["infinity","infty"]]);for(let[e,r]of Ie)G.set(e,r);for(let[e,r]of He)b.has(e)||b.set(e,b.get(r));var z=class extends Error{node;constructor(e,r=null){super(e),this.name="ConverterError",this.node=r}},$e=s.NONE.toNode(),Ye=["dim","id","im","mod","Pr","sech","csch"];function Fe(e){if(/^[a-zA-Z0-9]$/.test(e))return e;if(e==="/")return"\\/";if(["\\\\","\\{","\\}","\\%"].includes(e))return e.substring(1);if(["\\$","\\#","\\&","\\_"].includes(e))return e;if(e.startsWith("\\")){let r=e.slice(1);return b.has(r)?b.get(r):null}return e}function E(e,r){let t;switch(e.type){case 0:return s.NONE;case 2:t=1;break;case 1:t=2;break;case 3:t=3;break;case 4:t=5;break;case 5:t=6;break;case 6:t=8;break;case 7:{if(e.value==="\\\\")return new s(7,"\\");if(e.value==="\\!")return new s(1,"#h(-math.thin.amount)");if(b.has(e.value.substring(1))){let a=b.get(e.value.substring(1));return new s(1,a)}else throw new Error(`Unknown control sequence: ${e.value}`)}default:throw Error(`Unknown token type: ${e.type}`)}let n=Fe(e.value);if(n===null){if(r.nonStrict)return new s(t,e.value.substring(1));throw new z(`Unknown token: ${e.value}`,e)}return new s(t,n)}function Ge(e,r){let[t,n]=e.args;if(r.optimize&&["\\overset{\\text{def}}{=}","\\overset{d e f}{=}"].includes(e.toString()))return new s(1,"eq.def").toNode();let a=new m(new s(1,"limits"),[d(n,r)]);return new F({base:a,sup:d(t,r),sub:null})}function We(e,r){let[t,n]=e.args,a=new m(new s(1,"limits"),[d(n,r)]);return new F({base:a,sub:d(t,r),sup:null})}function je(e){let r={},t={l:"#left",c:"#center",r:"#right"},n=Array.from(e),a=[],i=0;for(let u of n)u==="|"?a.push(i):(u==="l"||u==="c"||u==="r")&&i++;if(a.length>0){let u;a.length===1?u=`#${a[0]}`:u=`#(vline: (${a.join(", ")}))`,r.augment=new s(3,u).toNode()}let l=n.map(u=>t[u]).filter(u=>u!==void 0).map(u=>new s(3,u).toNode());if(l.length>0){let u=l.every(c=>c.eq(l[0]));r.align=u?l[0]:new s(3,"#center").toNode()}return r}var Xe=new s(2,"("),Ve=new s(2,")");function te(e){return e.head.type===2&&["(",")","[","]","{","}","|","\u230A","\u230B","\u2308","\u2309"].includes(e.head.value)}function O(e){let r=["group","supsub","matrixLike","fraction","empty"].includes(e.type);if(e.type==="group"){let t=e;if(t.items.length===0)r=!0;else{let n=t.items[0],a=t.items[t.items.length-1];te(n)&&te(a)&&(r=!1)}}return r?new I(null,{left:Xe,right:Ve,body:e}):e}function d(e,r){switch(e.type){case"terminal":return E(e.head,r).toNode();case"text":{let n=e;return new s(4,n.head.value).toNode()}case"ordgroup":let t=e;return new J(t.items.map(n=>d(n,r)));case"supsub":{let n=e,{base:a,sup:i,sub:l}=n;if(a&&a.type==="funcCall"&&a.head.value==="\\overbrace"&&i)return new m(new s(1,"overbrace"),[d(a.args[0],r),d(i,r)]);if(a&&a.type==="funcCall"&&a.head.value==="\\underbrace"&&l)return new m(new s(1,"underbrace"),[d(a.args[0],r),d(l,r)]);let u={base:d(a,r),sup:i?d(i,r):null,sub:l?d(l,r):null};return u.base=O(u.base),u.sup&&(u.sup=O(u.sup)),u.sub&&(u.sub=O(u.sub)),new F(u)}case"leftright":{let n=e,{left:a,right:i}=n,l=d(n.body,r);if(r.optimize&&a!==null&&i!==null){let g=E(a,r),R=E(i,r);if(a.value==="\\|"&&i.value==="\\|")return new m(new s(1,"norm"),[l]);if(["[]","()","\\{\\}","\\lfloor\\rfloor","\\lceil\\rceil","\\lfloor\\rceil"].includes(a.value+i.value))return new J([g.toNode(),l,R.toNode()])}let u=function(g){return["(",")","{","["].includes(g.value)?new s(2,"\\"+g.value):g},c=a?E(a,r):null,h=i?E(i,r):null;return c===null&&h!==null&&(h=u(h)),h===null&&c!==null&&(c=u(c)),new I(new s(1,"lr"),{body:l,left:c,right:h})}case"funcCall":{let n=e,a=d(n.args[0],r);if(n.head.value==="\\sqrt"&&n.data){let i=d(n.data,r);return new m(new s(1,"root"),[i,a])}if(n.head.value==="\\mathbf"){let i=new m(new s(1,"bold"),[a]);return new m(new s(1,"upright"),[i])}if(n.head.value==="\\overrightarrow")return new m(new s(1,"arrow"),[a]);if(n.head.value==="\\overleftarrow")return new m(new s(1,"accent"),[a,new s(1,"arrow.l").toNode()]);if(n.head.value==="\\operatorname")return r.optimize&&Ye.includes(a.head.value)?new s(1,a.head.value).toNode():new m(new s(1,"op"),[new s(4,a.head.value).toNode()]);if(n.head.value==="\\textcolor"){let i=new Le(new s(1,"#text"),[d(n.args[1],r)]);return i.setOptions({fill:a}),i}if(n.head.value==="\\substack"||n.head.value==="\\displaylines"||n.head.value==="\\mathinner")return a;if(n.head.value==="\\mathrel")return new m(new s(1,"class"),[new s(4,"relation").toNode(),a]);if(n.head.value==="\\mathbin")return new m(new s(1,"class"),[new s(4,"binary").toNode(),a]);if(n.head.value==="\\mathop")return new m(new s(1,"class"),[new s(4,"large").toNode(),a]);if(n.head.value==="\\set")return new I(null,{body:a,left:s.LEFT_BRACE,right:s.RIGHT_BRACE});if(n.head.value==="\\not"){let i=d(n.args[0],r);if(f(i.type==="terminal"),i.head.type===1)return new s(1,i.head.value+".not").toNode();switch(i.head.value){case"=":return new s(1,"eq.not").toNode();default:throw new Error(`Not supported: \\not ${i.head.value}`)}}if(n.head.value==="\\overset")return Ge(n,r);if(n.head.value==="\\underset")return We(n,r);if(n.head.value==="\\frac"&&r.fracToSlash)return new ze(n.args.map(i=>d(i,r)).map(O));if(r.optimize){if(n.head.value==="\\mathbb"&&/^\\mathbb{[A-Z]}$/.test(n.toString()))return new s(1,a.head.value.repeat(2)).toNode();if(n.head.value==="\\mathrm"&&n.toString()==="\\mathrm{d}")return new s(1,"dif").toNode()}return new m(E(n.head,r),n.args.map(i=>d(i,r)))}case"beginend":{let n=e,a=n.matrix.map(i=>i.map(l=>d(l,r)));if(n.head.value.startsWith("align"))return new q(null,a);if(n.head.value==="cases")return new q(q.CASES,a);if(n.head.value==="subarray"){if(n.data)switch(n.data.head.value){case"r":a.forEach(l=>l.push(s.EMPTY.toNode()));break;case"l":a.forEach(l=>l.unshift(s.EMPTY.toNode()));break;default:break}return new q(null,a)}if(n.head.value==="array"){let i={delim:$e};f(n.data!==null&&n.head.type===3);let l=je(n.data.head.value);Object.assign(i,l);let u=new q(q.MAT,a);return u.setOptions(i),u}if(n.head.value.endsWith("matrix")){let i=new q(q.MAT,a),l;switch(n.head.value){case"matrix":l=s.NONE;break;case"pmatrix":return i;case"bmatrix":l=new s(4,"[");break;case"Bmatrix":l=new s(4,"{");break;case"vmatrix":l=new s(4,"|");break;case"Vmatrix":{l=new s(1,"bar.v.double");break}default:throw new z(`Unimplemented beginend: ${n.head}`,n)}return i.setOptions({delim:l.toNode()}),i}throw new z(`Unimplemented beginend: ${n.head}`,n)}default:throw new z(`Unimplemented node type: ${e.type}`,e)}}var Je=new o(1,",").toNode();var Ke=Array.from(Y.keys());function Ze(){return`(${Ke.map(r=>(r=r.replaceAll("|","\\|"),r=r.replaceAll(".","\\."),r=r.replaceAll("[","\\["),r=r.replaceAll("]","\\]"),r)).join("|")})`}var Qe=Ze(),et=new Map([[String.raw`//[^\n]*`,e=>new s(5,e.text().substring(2))],[String.raw`/`,e=>new s(2,e.text())],[String.raw`[_^&]`,e=>new s(7,e.text())],[String.raw`\r?\n`,e=>new s(8,`
`)],[String.raw`\s+`,e=>new s(6,e.text())],[String.raw`\\[$&#_]`,e=>new s(2,e.text())],[String.raw`\\\n`,e=>[new s(7,"\\"),new s(8,`
`)]],[String.raw`\\\s`,e=>[new s(7,"\\"),new s(6," ")]],[String.raw`\\\S`,e=>new s(7,"")],[String.raw`"([^"]|(\\"))*"`,e=>{let r=e.text().substring(1,e.text().length-1);return r.replaceAll('\\"','"'),new s(4,r)}],[Qe,e=>{let r=e.text(),t=Y.get(r);return new s(1,t)}],[String.raw`[0-9]+(\.[0-9]+)?`,e=>new s(2,e.text())],[String.raw`[+\-*/=\'<>!.,;?()\[\]|]`,e=>new s(2,e.text())],[String.raw`#h\((.+?)\)`,e=>{let r=e.reMatchArray();return[new s(1,"#h"),new s(2,"("),new s(3,r[1]),new s(2,")")]}],[String.raw`#none`,e=>new s(0,e.text())],[String.raw`#?[a-zA-Z\.]+`,e=>new s(e.text().length===1?2:1,e.text())],[String.raw`.`,e=>new s(2,e.text())]]);var tt=new s(2,"/").toNode();var rt=new s(7,"_"),nt=new s(7,"^"),at=new s(2,"("),st=new s(2,")"),it=new s(2,"["),lt=new s(2,"]"),ot=new s(2,"{"),ut=new s(2,"}"),ct=new s(2,","),ht=new s(2,";"),pt=new s(7,"&");function ie(e,r={}){let t={nonStrict:!0,preferShorthands:!0,keepSpaces:!1,fracToSlash:!0,inftyToOo:!1,optimize:!0,customTexMacros:{}};if(typeof r!="object")throw new Error("options must be an object");for(let l in t)l in r&&(t[l]=r[l]);let n=Me(e,t.customTexMacros),a=d(n,t),i=new Pe(t);return i.serialize(a),i.finalize()}globalThis.convert=ie;})();
